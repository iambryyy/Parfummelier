_format_version: "1.1"
services:
  - name: authentication-service
    url: http://authentication-service:5000
    routes:
      - name: auth-route
        paths:
          - /auth

  - name: user-service
    url: http://user-service:5000
    routes:
      - name: user-route
        paths:
          - /user

  - name: product-service
    url: http://product-service:5000
    routes:
      - name: product-route
        paths:
          - /products
        strip_path: true
        preserve_host: true
        methods:
          - GET
          - POST
          - PUT
          - DELETE
          - OPTIONS
      - name: recommendations-route
        paths:
          - /recommendations
        strip_path: false
        preserve_host: true
        methods:
          - POST
      - name: product-images-route
        paths:
          - /images
        strip_path: false
        preserve_host: true
        methods:
          - GET
    plugins:
      - name: cors
        config:
          origins: ["*"]
          methods: ["GET", "POST", "PUT", "DELETE", "OPTIONS"]
          headers:
            - "Accept"
            - "Accept-Version"
            - "Content-Length"
            - "Content-MD5"
            - "Content-Type"
            - "Date"
            - "Authorization"
          exposed_headers: ["*"]
          credentials: true
          max_age: 3600
      - name: response-transformer
        config:
          add:
            headers:
              - "Cache-Control: public, max-age=31536000"
              - "Access-Control-Allow-Origin: *"
          remove:
            headers:
              - "X-Kong-Response-Latency"
              - "Via"
      - name: proxy-cache
        config:
          content_type:
            - "text/plain"
            - "application/json"
            - "image/jpeg"
            - "image/jpg"
            - "image/png"
            - "image/gif"
            - "image/webp"
          cache_ttl: 3600
          strategy: memory
